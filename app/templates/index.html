{% extends "base.html" %}

{% block content %}
<div class="px-4 py-6 sm:px-0">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900">Total Questions</h3>
      <p class="mt-2 text-3xl font-bold text-gray-700">{{ total_questions }}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900">Accuracy</h3>
      <p class="mt-2 text-3xl font-bold text-gray-700">{{ "%.2f"|format(accuracy) }}%</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900">Time Spent</h3>
      <p class="mt-2 text-3xl font-bold text-gray-700">{{ time_spent // 60 }} min</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900">Avg. Time/Question</h3>
      <p class="mt-2 text-3xl font-bold text-gray-700">{{ "%.2f"|format(avg_time_per_question) }} sec</p>
    </div>
  </div>
  <div class="mt-8">
    <a href="{{ url_for('main.practice') }}" class="w-full bg-blue-600 text-white py-3 px-6 rounded-md text-lg font-medium block text-center hover:bg-blue-700">Start Practice</a>
  </div>

  <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Chem/Phys Performance</h3>
      <canvas id="chemPhysChart"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Bio/Biochem Performance</h3>
      <canvas id="bioBiochemChart"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Psych/Soc Performance</h3>
      <canvas id="psychSocChart"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">CARS Performance</h3>
      <canvas id="carsChart"></canvas>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Easy Performance</h3>
      <canvas id="easyChart"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Medium Performance</h3>
      <canvas id="mediumChart"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Hard Performance</h3>
      <canvas id="hardChart"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Overall Performance</h3>
      <canvas id="overallPerformanceChart"></canvas>
    </div>
  </div>

  <script>
    // Placeholder data for charts
    const chemPhysData = {{ chem_phys_data | tojson }};
    const bioBiochemData = {{ bio_biochem_data | tojson }};
    const psychSocData = {{ psych_soc_data | tojson }};
    const carsData = {{ cars_data | tojson }};

    const createChart = (ctx, data, label) => {
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Correct', 'Incorrect'],
          datasets: [{
            label: label,
            data: [data.correct, data.incorrect],
            backgroundColor: [
              'rgba(75, 192, 192, 0.6)',
              'rgba(255, 99, 132, 0.6)'
            ],
            borderColor: [
              'rgba(75, 192, 192, 1)',
              'rgba(255, 99, 132, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    };

    const chemPhysCtx = document.getElementById('chemPhysChart').getContext('2d');
    createChart(chemPhysCtx, chemPhysData, 'Chem/Phys Questions');

    const bioBiochemCtx = document.getElementById('bioBiochemChart').getContext('2d');
    createChart(bioBiochemCtx, bioBiochemData, 'Bio/Biochem Questions');

    const psychSocCtx = document.getElementById('psychSocChart').getContext('2d');
    createChart(psychSocCtx, psychSocData, 'Psych/Soc Questions');

    const carsCtx = document.getElementById('carsChart').getContext('2d');
    createChart(carsCtx, carsData, 'CARS Questions');

    // New charts
    const easyData = {{ easy_data | tojson }};
    const mediumData = {{ medium_data | tojson }};
    const hardData = {{ hard_data | tojson }};
    const overallPerformanceData = {{ overall_performance_data | tojson }};

    const easyCtx = document.getElementById('easyChart').getContext('2d');
    createChart(easyCtx, easyData, 'Easy Questions');

    const mediumCtx = document.getElementById('mediumChart').getContext('2d');
    createChart(mediumCtx, mediumData, 'Medium Questions');

    const hardCtx = document.getElementById('hardChart').getContext('2d');
    createChart(hardCtx, hardData, 'Hard Questions');

    const overallCtx = document.getElementById('overallPerformanceChart').getContext('2d');
    createChart(overallCtx, overallPerformanceData, 'Overall Performance');
  </script>
</div>
{% endblock %}
